<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CifVis: Crystal Structure Visualization</title>
  <link rel="stylesheet" href="node_modules/reveal.js/dist/reveal.css">
  <link rel="stylesheet" href="node_modules/reveal.js/dist/theme/white.css">
  <link rel="stylesheet" href="node_modules/reveal.js/plugin/highlight/monokai.css">
  <style>
    /* Global styles */
    .reveal {
      --slide-height: 1200px;
      --slide-padding: 40px;
      --heading-color: #333333;
      --content-font-size: 1.5em;
      --content-line-height: 1.5em;
    }

    /* Typography */
    .reveal h1 {
      font-size: 5em;
      margin-top: 100px;
      color: var(--heading-color);
    }

    .reveal h2 {
      font-size: 3em;
      margin-top: 50px;
      margin-bottom: 50px;
      color: var(--heading-color);
    }

    .reveal h3 {
      font-size: 1.3em;
      margin-top: 60px;
      margin-bottom: 20px;
      color: var(--heading-color);
    }

    .reveal p, .reveal ul {
      font-size: var(--content-font-size);
      line-height: var(--content-line-height);
      text-align: left;
    }

    /* Layout */
    .columns {
      display: flex;
      width: 100%;
      height: 100%;
      gap: 20px;
    }

    .column {
      flex: 1;
      padding: 0 10px;
      display: flex;
      flex-direction: column;
    }

    /* Code blocks */
    .reveal pre {
      width: 100%;
      margin: 0;
      max-height: 800px;
      overflow: auto;
    }

    .reveal pre code {
      padding: 15px;
      font-size: var(--content-font-size);
      line-height: var(--content-line-height);
    }

    /* CifVis containers */
    .cifvis-container {
      width: 100%;
      height: 100%;
      flex-grow: 1;
    }

    /* Buttons */
    .reload {
      font-size: 0.8em;
      width: 100%;
      height: 60px;
      margin: 10px 0;
      cursor: pointer;
      background-color: #f0f0f0;
      border: 1px solid #ccc;
      border-radius: 4px;
      transition: background-color 0.3s;
    }

    .reload:hover {
      background-color: #e0e0e0;
    }

    section {
        height: calc(var(--slide-height) - 2 * var(--slide-padding));
    }

    .button-row {
      display: flex;
      gap: 10px;
      margin: 20px 0;
    }

    /* Spacers */
    .spacer {
      flex-grow: 1;
    }

    /* CifVis widget customization */
    cifview-widget {
      border-radius: 0 !important;
      background: white !important;
      height: 100%;
    }

    cifview-widget .crystal-caption {
      font-size: 1em !important;
      border-top: 2px solid #333333 !important;
    }

    cifview-widget .control-button {
      width: 80px !important;
      height: 80px !important;
      background: rgb(255, 255, 255) !important;
      border: 1px solid rgb(170, 170, 170) !important;
      border-radius: 5px !important;
    }

    cifview-widget .control-button svg {
      width: 60px !important;
      height: 60px !important;
    }

    /* Architecture slide styles */
    .architecture-layers {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .layer {
    margin-bottom: 30px;
    font-size: calc(0.6 * var(--content-font-size));
    }

    .layer-name {
    font-weight: bold;
    margin-bottom: 10px;
    font-size: 1.2em;
    }

    .layer-desc {
    line-height: 1.2;
    }

    .architecture-diagram {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0px;
    }

    .arch-layer {
    width: 100%;
    display: flex;
    justify-content: center;
    }

    .arch-box {
    width: 80%;
    padding: 5px;
    border-radius: 5px;
    text-align: center;
    color: white;
    }

    .arch-box h4 {
    margin: 0 0 5px 0;
    font-size: 1em;
    }

    .arch-box p {
    margin: 0 0 5px 0;
    font-size: 0.7em;
    text-align: center;
    }

    .arch-details {
    font-size: 0.6em;
    }

    .arch-arrow {
    font-size: 2.5em;
    color: #666;
    }

    .cif {
    background-color: #3066BE;
    }

    .crystal {
    background-color: #119DA4;
    }

    .ortep {
    background-color: #6D9DC5;
    }

    .viewer {
    background-color: #80DED9;
    color: #333;
    }
  </style>
</head>
<body>
  <div class="reveal">
    <div class="slides">
      <!-- Title Slide -->
      <section>
        <h1>CifVis</h1>
        <h2>Crystal Structure Visualization in JavaScript</h2>
        <p style="font-size: 2em; text-align: center;">
          Dr. Paul Niklas Ruth
        </p>
        <p style="font-size: 2em; text-align: center;">
          Advanced Research Computing
        </p>
        <p style="font-size: 2em; text-align: center;">
          Durham University
        </p>
      </section>

      <!-- What is CifVis Slide -->
      <section>
        <h2>What is CifVis?</h2>
        <div style="font-size: 1em; text-align: left;">
          <p>A JavaScript library and web component that enables:</p>
          <ul>
            <li>Interactive 3D visualization of crystal structures</li>
            <li>Direct reading of Crystallographic Information Files (CIF)</li>
            <li>Support for anisotropic displacement parameters (thermal ellipsoids)</li>
            <li>No server-side processing required</li>
            <li>Simple integration into websites or applications</li>
          </ul>
        </div>
      </section>

      <!-- Interaction Slide -->
      <section>
        <h2>Interaction with the display</h2>
        <div class="columns">
          <div class="column">
            <h3>Mouse interaction</h3>
            <p>
              Rotate: left drag<br>
              Select: left click<br>
              Drag: right drag<br>
              Zoom: Mouse wheel
            </p>

            <h3>Touch interaction</h3>
            <p>
              Rotate: one-finger drag<br>
              Select: one-finger touch<br>
              Drag: two-finger drag<br>
              Zoom: two-finger pinch
            </p>
          </div>
          <div class="column">
            <div class="cifvis-container" id="cifvis-interaction">
              <cifview-widget
                src="/src/capsaicin.cif"
                caption="Crystal structure of capsaicin <a href='https://doi.org/10.1107/S2053229625001706' target='_blank'>(Lozinšek, 2025)</a>."
                hydrogen-mode="constant">
              </cifview-widget>
            </div>
          </div>
        </div>
      </section>

      <!-- Adaptive Buttons Slide -->
      <section>
        <h2>Buttons are adapted to the structure</h2>
        <div class="columns">
          <div class="column">
            <div class="cifvis-container">
              <cifview-widget
                src="/src/capsaicin.cif"
                caption="Hydrogen button adapts to hydrogens present <a href='https://doi.org/10.1107/S2053229625001706' target='_blank'>(Lozinšek, 2025)</a>."
                hydrogen-mode="constant">
              </cifview-widget>
            </div>
          </div>
          <div class="column">
            <div class="cifvis-container">
              <cifview-widget
                src="/src/capsaicin.cif"
                caption="If disorder is present: an additional button will appear <a href='https://doi.org/10.1107/S2053229625001706' target='_blank'>(Lozinšek, 2025)</a>."
                hydrogen-mode="constant">
              </cifview-widget>
            </div>                
          </div>
          <div class="column">
            <div class="cifvis-container">
              <cifview-widget
                src="/src/capsaicin.cif"
                caption="There is also an adaptive button for growing structures if bonds outside structures are present <a href='https://doi.org/10.1107/S2053229625001706' target='_blank'>(Lozinšek, 2025)</a>."
                hydrogen-mode="constant">
              </cifview-widget>
            </div>    
          </div>
        </div>
      </section>

      <!-- CIF Display Slide -->
      <section>
        <h2>CifVis displays what is in the CIF file</h2>
        <div class="columns">
          <div class="column">
            <ul>
              <li>Bonds are read from CIF</li>
              <li>This includes hydrogen bonds</li>
              <li>Only if all bonds are missing, CifVis will add them</li>
            </ul>
            <div class="button-row">
              <button class="reload" id="btn-load-bonds">Reload with bonds</button>
              <button class="reload" id="btn-load-nobonds">Reload without bonds</button>
            </div>
            <div class="spacer"></div>
            <ul>
              <li>Invalid cifs will create an error message.</li>
            </ul>
            <button class="reload" id="btn-load-invalid">Load invalid structure</button>
          </div>
          <div class="column">
            <div class="cifvis-container" id="cifvis-loading">
              <cifview-widget
                src="/src/large_nobonds.cif"
                caption="Crystal Structure Caption"
                id="cifview-loading">
              </cifview-widget>
            </div>
          </div>
        </div>
      </section>

      <!-- Integration Slide -->
      <section>
        <h2>Integration as HTML Component</h2>
        <div class="columns">
          <div class="column">
            <pre style="height: 100%;"><code class="html">&lt;script type="module"&gt;
  import { CifViewWidget } from 'cifvis';
&lt;/script&gt;

&lt;cifview-widget 
  src="example.cif"
  caption="Crystal Structure Caption"
  hydrogen-mode="constant"&gt;
&lt;/cifview-widget&gt;</code></pre>
          </div>
          <div class="column">
            <div class="cifvis-container" id="cifvis-demo">
              <cifview-widget
                src="/src/xylitol.cif"
                caption="Crystal Structure Caption"
                hydrogen-mode="constant">
              </cifview-widget>
            </div>
          </div>
        </div>
      </section>

      <!-- Filtered Atoms Slide -->
      <section>
        <h2>Atoms can be omitted</h2>
        <div class="columns">
          <div class="column">
            No filtered atoms
            <div class="cifvis-container">
              <cifview-widget 
                src="src/fullerene.cif"
                caption="Complete structure including solvent molecules">
              </cifview-widget>
            </div>
          </div>
          <div class="column">
            <code>filtered-atoms="C200,H200,C201>H218"</code>
            <div class="cifvis-container">
              <cifview-widget 
                src="src/fullerene.cif"
                caption="Structure with solvent molecules removed"
                filtered-atoms="C200,H200,C201>H218">
              </cifview-widget>
            </div>
          </div>
        </div>
      </section>

      <section>
        <h2>CifVis Library Architecture</h2>
        <div class="columns" style="align-items: center;">
          <div class="column">
            <ul class="architecture-layers">
              <li class="layer">
                <div class="layer-name">CIF</div>
                <div class="layer-desc">Parses the CIF text format into structured data</div>
              </li>
              <li class="layer">
                <div class="layer-name">CrystalStructure</div>
                <div class="layer-desc">Creates a model with atoms, bonds, and unit cell information</div>
              </li>
              <li class="layer">
                <div class="layer-name">ORTEP3DStructure</div>
                <div class="layer-desc">Builds 3D visual representation with Three.js objects</div>
              </li>
              <li class="layer">
                <div class="layer-name">CrystalViewer</div>
                <div class="layer-desc">Provides interactive camera, selection, and display controls</div>
              </li>
            </ul>
          </div>
          <div class="column">
            <div class="architecture-diagram">
              <div class="arch-layer">
                <div class="arch-box cif">
                  <h4>CIF</h4>
                  <p>Text → Structured Data</p>
                  <div class="arch-details">Loops, Blocks, Data</div>
                </div>
              </div>
              <div class="arch-arrow">↓</div>
              <div class="arch-layer">
                <div class="arch-box crystal">
                  <h4>CrystalStructure</h4>
                  <p>Domain Model</p>
                  <div class="arch-details">Atoms, Bonds, Cell, Symmetry</div>
                </div>
              </div>
              <div class="arch-arrow">↓</div>
              <div class="arch-layer">
                <div class="arch-box ortep">
                  <h4>ORTEP3DStructure</h4>
                  <p>Visual Model</p>
                  <div class="arch-details">Meshes, Materials, Transformations</div>
                </div>
              </div>
              <div class="arch-arrow">↓</div>
              <div class="arch-layer">
                <div class="arch-box viewer">
                  <h4>CrystalViewer</h4>
                  <p>User Interface</p>
                  <div class="arch-details">Camera, Selection, Modifiers</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>

  

  <!-- Scripts -->
  <script src="node_modules/reveal.js/dist/reveal.js"></script>
  <script src="node_modules/reveal.js/plugin/highlight/highlight.js"></script>
  <script src="node_modules/d3/dist/d3.min.js"></script>
  <script type="module">
    import { CifViewWidget } from 'cifvis';
    
    // Initialize Reveal.js
    Reveal.initialize({
      width: 2560,
      height: 1440,
      controls: true,
      progress: true,
      center: false,
      hash: true,
      plugins: [ RevealHighlight ]
    });

    // Button event handlers
    const loadBondsButton = document.getElementById("btn-load-bonds");
    loadBondsButton.addEventListener('click', () => {
      loadingDemonstration("/src/large_bonds.cif");
    });

    const loadNoBondsButton = document.getElementById("btn-load-nobonds");
    loadNoBondsButton.addEventListener('click', () => {
      loadingDemonstration("/src/large_nobonds.cif");
    });

    const loadInvalidButton = document.getElementById("btn-load-invalid");
    loadInvalidButton.addEventListener('click', () => {
      loadingDemonstration("/src/invalid.cif");
    });

    function loadingDemonstration(file) {
      const loadingWidget = document.getElementById("cifview-loading");
      loadingWidget.setAttribute("src", file);
    }
  </script>
</body>
</html>